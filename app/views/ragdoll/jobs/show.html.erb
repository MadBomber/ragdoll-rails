<% content_for(:title, "Job Details") %>

<%= render Ragdoll::PageHeaderComponent.new(
  title: "Job Details",
  subtitle: "View job information and execution details",
  icon: "fas fa-info-circle"
) %>

<div class="row">
  <div class="col-md-8">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-cog"></i> Job Information
        </h5>
      </div>
      <div class="card-body">
        <dl class="row">
          <dt class="col-sm-3">Job ID:</dt>
          <dd class="col-sm-9"><%= @job.id %></dd>
          
          <dt class="col-sm-3">Class:</dt>
          <dd class="col-sm-9"><code><%= @job.class_name %></code></dd>
          
          <dt class="col-sm-3">Status:</dt>
          <dd class="col-sm-9">
            <% if @job.finished_at %>
              <%= render Ragdoll::StatusBadgeComponent.new(status: "completed") %>
            <% else %>
              <%= render Ragdoll::StatusBadgeComponent.new(status: "pending") %>
            <% end %>
          </dd>
          
          <dt class="col-sm-3">Priority:</dt>
          <dd class="col-sm-9"><%= @job.priority %></dd>
          
          <dt class="col-sm-3">Queue:</dt>
          <dd class="col-sm-9"><%= @job.queue_name %></dd>
          
          <dt class="col-sm-3">Created:</dt>
          <dd class="col-sm-9">
            <%= @job.created_at.strftime("%B %d, %Y at %I:%M %p") %>
            <small class="text-muted">(<%= time_ago_in_words(@job.created_at) %> ago)</small>
          </dd>
          
          <% if @job.scheduled_at %>
            <dt class="col-sm-3">Scheduled For:</dt>
            <dd class="col-sm-9">
              <%= @job.scheduled_at.strftime("%B %d, %Y at %I:%M %p") %>
              <% if @job.scheduled_at > Time.current %>
                <small class="text-muted">(in <%= time_ago_in_words(@job.scheduled_at) %>)</small>
              <% end %>
            </dd>
          <% end %>
          
          <% if @job.finished_at %>
            <dt class="col-sm-3">Finished:</dt>
            <dd class="col-sm-9">
              <%= @job.finished_at.strftime("%B %d, %Y at %I:%M %p") %>
              <small class="text-muted">(<%= time_ago_in_words(@job.finished_at) %> ago)</small>
            </dd>
            
            <dt class="col-sm-3">Duration:</dt>
            <dd class="col-sm-9">
              <%= distance_of_time_in_words(@job.created_at, @job.finished_at) %>
            </dd>
          <% end %>
        </dl>
      </div>
    </div>

    <% if @job.arguments.present? %>
      <div class="card mt-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-list"></i> Arguments
          </h5>
        </div>
        <div class="card-body">
          <pre class="bg-light p-3 rounded"><code><%= JSON.pretty_generate(@job.arguments) %></code></pre>
        </div>
      </div>
    <% end %>
  </div>

  <div class="col-md-4">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-tools"></i> Actions
        </h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <%= link_to ragdoll.jobs_path, class: "btn btn-outline-secondary" do %>
            <i class="fas fa-arrow-left"></i> Back to Jobs
          <% end %>
          
          <% unless @job.finished_at %>
            <%= link_to ragdoll.job_path(@job), method: :delete,
                        class: "btn btn-outline-danger",
                        data: { confirm: "Are you sure you want to delete this job?" } do %>
              <i class="fas fa-trash"></i> Delete Job
            <% end %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-info"></i> Job Stats
        </h5>
      </div>
      <div class="card-body">
        <small class="text-muted">
          <% if @job.finished_at %>
            This job completed successfully.
          <% elsif @job.scheduled_at && @job.scheduled_at > Time.current %>
            This job is scheduled to run in the future.
          <% else %>
            This job is waiting to be processed.
          <% end %>
        </small>
      </div>
    </div>
  </div>
</div>